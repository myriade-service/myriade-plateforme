#!/bin/bash
# scripts/check-secrets.sh

echo "ðŸ” VÃ©rification des secrets dans le code..."

# Fichiers Ã  vÃ©rifier
# shellcheck disable=SC2034
FILES_TO_CHECK=(
  "src/main/resources/application.yml"
  "src/main/resources/application-*.yml"
  "**/*.properties"
  "**/*.java"
  "**/*.kt"
)

# Patterns de secrets
SECRET_PATTERNS=(
  "password.*="
  "secret.*="
  "key.*="
  "token.*="
  "api.*key"
  "jwt.*secret"
  "encryption.*key"
  "private.*key"
  "BEGIN PRIVATE KEY"
  "BEGIN RSA PRIVATE KEY"
)

for file in $(find . -type f \( -name "*.yml" -o -name "*.yaml" -o -name "*.properties" -o -name "*.java" \) ! -path "./target/*" ! -path "./.git/*"); do
  for pattern in "${SECRET_PATTERNS[@]}"; do
    if grep -n -i "$pattern" "$file" 2>/dev/null | grep -v "example" | grep -v "test" | grep -v "dummy"; then
      echo "ðŸš¨ POTENTIEL SECRET TROUVÃ‰ dans $file"
      grep -n -i "$pattern" "$file"
      echo ""
    fi
  done
done

echo "âœ… VÃ©rification terminÃ©e"